ErrorParser=function(){},ErrorParser.prototype={parse:function(a){if(401===a.status)switch(a.responseText){case"token_expired":return"refresh";case"token_invalid":return"reniew"}}},OAuth2Client=function(a){if(this._accessTokenResponseStorage=null,this._tokenEndpoint=null,"object"!=typeof a)throw new Error("A configuration object is required !");if("string"!=typeof a.tokenEndpoint)throw new Error("A token endpoint is required !");this._tokenEndpoint=a.tokenEndpoint,this._accessTokenResponseStorage=new AccessTokenResponseStorage(a)},OAuth2Client.prototype={_backupedBackboneDotAjax:null},StorageManager=function(a){if(this._storage=localStorage,this._storageKey="oauth.js","undefined"==typeof Storage)throw new Error("Your browser does not support HTML5 Web Storage !");if("object"==typeof a){switch(a.storage){case"local":case null:case void 0:this._storage=localStorage;break;case"session":this._storage=sessionStorage;break;default:throw new Error("Invalid storage value provided !")}this._storageKey="string"==typeof a.storageKey?a.storageKey:"oauth.js"}},StorageManager.prototype={getAccessToken:function(){var a=this.getAccessTokenResponse(),b=null!==a?a.access_token:null;return null===b||void 0===b?null:b},getAccessTokenResponse:function(){var a=this._storage.getItem(this._storageKey+".accessTokenResponse");return null!==a?JSON.parse(a):null},getRefreshToken:function(){var a=this.getAccessTokenResponse(),b=null!==a?a.refresh_token:null;return null===b||void 0===b?null:b},persistRawAccessTokenResponse:function(a){this._storage.setItem(this._storageKey+".accessTokenResponse",a)}},BackboneRequestManager=function(a){if(this._backupedBackboneDotAjax=null,this._clientType="backbone",this._errorParser=null,this._storageManager=null,this._tokenEndpoint=null,"undefined"==typeof Backbone||null===Backbone)throw new Error("Backbone is not available !");if("function"!=typeof Backbone.ajax)throw new Error("No valid 'Backbone.ajax' method has been found !");this._backupedBackboneDotAjax=Backbone.ajax,"object"==typeof a?(this._errorParser="undefined"!=typeof a.errorParser?a.errorParser:new ErrorParser,this._storageManager=new StorageManager({storage:a.storage,storageKey:a.storageKey})):(this._errorParser=new ErrorParser,this._storageManager=new StorageManager)},BackboneRequestManager.prototype={getStorageManager:function(){return this._storageManager},start:function(){var a=this;Backbone.ajax=function(){return a._overwrittenBackboneDotAjax.apply(a,arguments)}},_jQueryAjaxPromiseDone:function(a,b,c,d,e){b.resolve(c,d,e)},_jQueryAjaxPromiseFail:function(a,b,c,d,e){var f=this._errorParser.parse(c);if(void 0!==f)switch(f){case"refresh":this._refreshAccessToken(a,b);break;case"reniew":this._reniewAccessToken(a,b);break;default:throw new Error("Action '"+f+"' is invalid !")}else b.reject(c,d,e)},_updateAjaxArgumentsWithAccessToken:function(a){var b=this._storageManager.getAccessToken();b&&("string"==typeof a[0]?(a[0]+=-1===a[0].indexOf("?")?"?":"&",a[0]+="access_token",a[0]+="=",a[0]+=b):(a[0].url+=-1===a[0].url.indexOf("?")?"?":"&",a[0].url+="access_token",a[0].url+="=",a[0].url+=b))},_cloneAjaxSettings:function(a){for(var b=["accepts","async","beforeSend","cache","complete","contents","contentType","context","converters","crossDomain","data","dataFilter","dataType","error","global","headers","isModified","isLocal","jsonp","jsonpCallback","mimeType","password","processData","scriptCharset","statusCode","success","timeout","traditional","type","url","username","xhr","xhrFields"],c={},d=0;d<b.length;++d)"undefined"!=typeof a[b[d]]&&(c[b[d]]=a[b[d]]);return c},_cloneAjaxArguments:function(a){var b={};return"string"==typeof a[0]?(b[0]=a[0],2===b.length&&(b[1]=this._cloneAjaxSettings(a[1]))):b[0]=this._cloneAjaxSettings(a[0]),b},_overwrittenBackboneDotAjax:function(){var a=this._cloneAjaxArguments(arguments);this._updateAjaxArgumentsWithAccessToken(arguments);var b=Backbone.$.ajax.apply(Backbone.$,arguments),c=$.Deferred();return b.fail($.proxy(this._jQueryAjaxPromiseFail,this,a,c)),b.done($.proxy(this._jQueryAjaxPromiseDone,this,a,c)),c},_onOriginalAjaxReplayedDone:function(a,b,c,d){oAuthPromise.resolve(b,c,d)},_onOriginalAjaxReplayedFail:function(a,b,c,d){oAuthPromise.reject(b,c,d)},_onRefreshAccessTokenSuccess:function(a,b,c){this._storageManager.persistRawAccessTokenResponse(JSON.stringify(c)),$.ajax(a).done($.proxy(this._onOriginalAjaxReplayedDone,this,b)).fail($.proxy(this._onOriginalAjaxReplayedFail,this,b))},_refreshAccessToken:function(a,b){var c=this._storageManager.getRefreshToken();c?$.ajax({url:this._tokenEndpoint,data:{grant_type:"refresh_token",refresh_token:c},dataType:"json",type:"POST",error:$.proxy(this._reniewAccessToken,this,b),success:$.proxy(this_onRefreshAccessTokenSuccess,this,a,b)}):this._reniewAccessToken(a,b)},_reniewAccessToken:function(){}};
//# sourceMappingURL=oauth.min.js.map